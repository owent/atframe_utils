
# Lua模块
find_package(Lua51)
if (LUA51_FOUND)
    include_directories(${LUA_INCLUDE_DIR})
    list(APPEND EXTENTION_LINK_LIB ${LUA_LIBRARIES})
    message(STATUS "Lua support enabled.(lua 5.1 detected)")
elseif(ENABLE_LUA_SUPPORT)
    message(STATUS "Lua support enabled.(enabled by custom)")
else()
    message(STATUS "Lua support disabled")
    set(LOG_WRAPPER_DISABLE_LUA_SUPPORT 1)
endif()

# traceback 检测
if (LIBUNWIND_ENABLED)
    find_package(Libunwind)
    if (Libunwind_FOUND)
        set(LOG_STACKTRACE_USING_LIBUNWIND 1)
    else()
        EchoWithColor(COLOR YELLOW " -- Stacktrace: LIBUNWIND_ENABLED=YES but we can not find libunwind.")
    endif()
endif()

if (NOT LOG_STACKTRACE_USING_LIBUNWIND)
    if (WIN32 OR CYGWIN OR MINGW)
        find_path(LOG_STACKTRACE_DBG_HELP_DIR NAMES DbgHelp.h)
        if(LOG_STACKTRACE_DBG_HELP_DIR)
            set(LOG_STACKTRACE_USING_DBGHELP 1)
            EchoWithColor(COLOR GREEN " -- Stacktrace: LOG_STACKTRACE_USING_DBGHELP=${LOG_STACKTRACE_USING_DBGHELP}.")
        else()
            find_path(LOG_STACKTRACE_DBG_ENG_DIR NAMES DbgEng.h)
            if(LOG_STACKTRACE_DBG_ENG_DIR)
                set(LOG_STACKTRACE_USING_DBGENG 1)
                EchoWithColor(COLOR GREEN " -- Stacktrace: LOG_STACKTRACE_USING_DBGENG=${LOG_STACKTRACE_USING_DBGENG}.")
            else()
                EchoWithColor(COLOR YELLOW " -- Stacktrace: Can not find DbgHelp.h or DbgEng.h, disable it.")
            endif()
        endif()
    elseif (UNIX)
        find_path(LOG_STACKTRACE_EXECINFO_DIR NAMES DbgHelp.h)
        if(LOG_STACKTRACE_EXECINFO_DIR)
            set(LOG_STACKTRACE_USING_EXECINFO 1)
            EchoWithColor(COLOR GREEN " -- Stacktrace: LOG_STACKTRACE_USING_EXECINFO=${LOG_STACKTRACE_USING_EXECINFO}.")
        else()
            find_path(LOG_STACKTRACE_UNWIND_DIR NAMES DbgEng.h)
            if(LOG_STACKTRACE_UNWIND_DIR)
                set(LOG_STACKTRACE_USING_UNWIND 1)
                EchoWithColor(COLOR GREEN " -- Stacktrace: LOG_STACKTRACE_USING_UNWIND=${LOG_STACKTRACE_USING_UNWIND}.")
            else()
                EchoWithColor(COLOR YELLOW " -- Stacktrace: Can not find DbgHelp.h or DbgEng.h, disable it.")
            endif()
        endif()
    else ()
        EchoWithColor(COLOR YELLOW " -- Stacktrace: Unsupportedd for stacktrace, disable it.")
    endif()
endif()